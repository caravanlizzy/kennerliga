import{_ as j,Q as ee}from"./KennerInput.8674c32d.js";import{y as q,o as u,A as I,af as G,h as g,a as r,w as $,B as z,aa as K,a9 as M,_ as E,aY as Q,c as b,ah as k,D as te,F as _,aZ as T,Q as D,P as L,m as N,O as oe,C as S,at as H,d as ae,ar as C,aW as W,aX as X,ab as ne,t as se}from"./index.9a6af9dc.js";import{n as le}from"./reponsive.47e55779.js";import{_ as U}from"./KennerSelect.67eb17a3.js";import{_ as x}from"./KennerButton.95e53cea.js";import{Q as V}from"./QToggle.1309c8b6.js";import{Q as F}from"./QInput.2425900d.js";import{Q as B}from"./QSeparator.c47fda76.js";import{Q as ie}from"./QCardSection.e40e87fc.js";import{Q as Y}from"./QCard.81ceb32b.js";import"./QSelect.815809a5.js";import"./scroll.e98cb3f3.js";import"./use-checkbox.20d24288.js";const re={class:"q-pa-sm text-accent text-h6 row flex-center"},ce=q({__name:"KennerCounter",props:{content:{}},setup(o){return(e,t)=>(u(),I("div",re,G(e.content+1),1))}});const ue={class:"q-px-md q-pb-sm"},de={key:0},me=["onClick"],pe={key:0,class:"row"},ve={class:"column"},fe={class:"column justify-center item-start"},_e=q({__name:"ListCreator",props:{buttonLabel:{},ranked:{type:Boolean}},emits:["updateList"],setup(o,{emit:e}){const t=e,a=g([]),s=g({itemId:-1,name:"",isEditable:!1});function l(){!s.value.name||(s.value.itemId=Q(),a.value.push({...s.value}),a.value.sort((n,i)=>n.name.localeCompare(i.name,void 0,{numeric:!0,sensitivity:"base"})),s.value={...s.value,isEditable:!1,name:""},p())}function m(n){n>0&&n<a.value.length&&([a.value[n],a.value[n-1]]=[a.value[n-1],a.value[n]]),p()}function h(n){n>=0&&n<a.value.length+1&&([a.value[n],a.value[n+1]]=[a.value[n+1],a.value[n]]),p()}function v(n){a.value=a.value.filter(i=>i!==n),p()}function p(){t("updateList",a.value.map(({isEditable:n,...i})=>i))}return(n,i)=>(u(),I("div",ue,[r(F,{filled:"",square:"","bottom-slots":"","hide-bottom-space":"",label:n.buttonLabel,modelValue:s.value.name,"onUpdate:modelValue":i[0]||(i[0]=c=>s.value.name=c),onKeyup:z(l,["enter"])},{append:$(()=>[r(x,{round:"",dense:"",flat:"",icon:"add",onClick:l})]),_:1},8,["label","modelValue"]),(u(!0),I(K,null,M(a.value,(c,y)=>(u(),I("div",{key:c.id},[c.isEditable?(u(),I("div",de,[r(F,{square:"","bottom-slots":"","hide-bottom-space":"",label:"editieren",color:"info",class:"text-white",modelValue:c.name,"onUpdate:modelValue":O=>c.name=O},{prepend:$(()=>[n.ranked?(u(),b(ce,{key:0,content:y},null,8,["content"])):k("",!0)]),append:$(()=>[r(x,{color:"info",dense:"",flat:"",icon:"check",onClick:O=>c.isEditable=!1,onBlur:O=>c.isEditable=!1},null,8,["onClick","onBlur"])]),_:2},1032,["modelValue","onUpdate:modelValue"])])):(u(),I("div",{key:1,onClick:()=>c.isEditable=!0,class:te(["flex justify-between q-pa-sm rounded item-border",{"border-bottom":y===a.value.length-1}])},[n.ranked?(u(),I("div",pe,[_("div",ve,[y>0?(u(),b(D,{key:0,flat:"",icon:"arrow_drop_up",size:"sm",onClick:T(O=>m(y),["stop"])},null,8,["onClick"])):k("",!0),y<a.value.length-1?(u(),b(D,{key:1,flat:"",icon:"arrow_drop_down",size:"sm",onClick:T(O=>h(y),["stop"])},null,8,["onClick"])):k("",!0)])])):k("",!0),_("div",fe,G(c.name),1),r(x,{icon:"close",onClick:O=>v(c),color:"accent",flat:"",dense:""},null,8,["onClick"])],10,me))]))),128))]))}});var A=E(_e,[["__scopeId","data-v-7cc80292"]]);const he={class:"column q-pa-xs q-mt-lg"},ge=_("div",{class:"q-mx-xs q-mb-xs text-bold"},"Auswahloptionen",-1),ye=q({__name:"GameOptionChoiceCreate",props:{gameOption:{},addChoice:{type:Function}},setup(o){const{updateItem:e}=L("useGameOptions"),t=o;function a(s){e(t.gameOption,"choices",s)}return(s,l)=>(u(),I("div",he,[ge,r(A,{"button-label":"Neue Option",onUpdateList:a})]))}}),be={class:"column q-pa-xs q-mt-lg bg-brown-1 q-pa-md"},Ie=_("div",{class:"row items-center justify-between"},[_("div",{class:"q-mx-xs text-bold"},"Bedingung")],-1),we=q({__name:"GameOptionRestrictionCreate",props:{gameOption:{}},setup(o){const e=o,{updateItem:t,items:a}=L("useGameOptions"),s=g(null),l=g({booleanActive:!0,choiceSelection:{name:null,itemId:null}}),m=N(()=>l.value.booleanActive?"Bedingte Option muss aktiv sein":"Bedingte Option muss inaktiv sein"),h=N(()=>a.value.filter(p=>p.title!==e.gameOption.title));function v(){var p,n,i,c;t(e.gameOption,"onlyIfOption",(p=s.value)==null?void 0:p.itemId),(n=s.value)!=null&&n.hasChoices?(t(e.gameOption,"onlyIfValue",void 0),t(e.gameOption,"onlyIfChoice",(i=l.value)==null?void 0:i.choiceSelection.itemId)):(t(e.gameOption,"onlyIfChoice",void 0),t(e.gameOption,"onlyIfValue",(c=l.value)==null?void 0:c.booleanActive))}return(p,n)=>(u(),I("div",be,[Ie,r(B,{class:"q-mt-md q-mb-xs"}),r(U,{modelValue:s.value,"onUpdate:modelValue":[n[0]||(n[0]=i=>s.value=i),v],options:h.value,class:"q-my-md","option-value":"title","option-label":"title",label:"Option","map-options":"",rules:[i=>!!i||"Auswahl erforderlich"]},null,8,["modelValue","options","rules"]),s.value&&s.value.hasChoices?(u(),b(U,{key:0,modelValue:l.value.choiceSelection,"onUpdate:modelValue":[n[1]||(n[1]=i=>l.value.choiceSelection=i),v],options:s.value.choices,class:"q-my-md","option-value":"name","option-label":"name",label:"Bedingter Wert",rules:[i=>!!i||"Auswahl erforderlich"]},null,8,["modelValue","options","rules"])):s.value&&!s.value.hasChoices?(u(),b(V,{key:1,color:"accent","model-value":l.value.booleanActive,"onUpdate:modelValue":n[2]||(n[2]=i=>{l.value.booleanActive=!l.value.booleanActive,v()}),label:m.value},null,8,["model-value","label"])):k("",!0)]))}}),Oe={};function ke(o,e){return u(),b(Y,{bordered:"",class:"q-mt-lg column q-mx-md"},{default:$(()=>[r(B),r(ie,null,{default:$(()=>[oe(o.$slots,"content")]),_:3})]),_:3})}var Ce=E(Oe,[["render",ke]]);const Se={class:"flex justify-end"},$e={class:"col"},Ve={class:"column"},qe=q({__name:"GameOptionCreate",props:{gameOption:{}},setup(o){const e=o,{gameOption:t}=e,{updateItem:a,deleteItem:s}=L("useGameOptions"),l=g(!1);function m(i){a(t,"hasChoices",i)}function h(){l.value||(a(t,"onlyIfOption",void 0),a(t,"onlyIfChoice",void 0),a(t,"onlyIfValue",void 0))}function v(){s(e.gameOption)}function p(i){a(t,"title",i)}function n(){const i={itemId:Q(),name:""};a(t,"choices",[...e.gameOption.choices,i])}return(i,c)=>(u(),b(Ce,null,{content:$(()=>[_("div",Se,[r(x,{flat:"",color:"accent",size:"md",class:"close-button q-pa-none",icon:"delete",onClick:v})]),_("div",$e,[r(j,{"model-value":S(t).title,"onUpdate:modelValue":p,label:"Spieloption Titel",class:"q-mb-md q-mx-xs",rules:[y=>!!y||"Titel erforderlich"]},null,8,["model-value","rules"]),_("div",Ve,[r(V,{"model-value":S(t).hasChoices,"onUpdate:modelValue":m,label:"Auswahloptionen"},null,8,["model-value"]),r(V,{label:"Bedingungen","model-value":l.value,"onUpdate:modelValue":c[0]||(c[0]=y=>{l.value=!l.value,h()})},null,8,["model-value"])]),S(t).hasChoices?(u(),b(ye,{key:0,addChoice:n,gameOption:S(t)},null,8,["gameOption"])):k("",!0),l.value?(u(),b(we,{key:1,gameOption:S(t)},null,8,["gameOption"])):k("",!0)])]),_:1}))}});var xe=E(qe,[["__scopeId","data-v-6a526f12"]]);function Be(o){const e=g([]);o&&e.value.push(...o);function t(l,{prepend:m=!1}={}){m?e.value.unshift(l):e.value.push(l)}function a(l){e.value=e.value.filter(m=>m.itemId!==l.itemId)}function s(l,m,h){const v=e.value.find(p=>p.itemId===l.itemId);v&&(v[m]=h)}return{items:e,addItem:t,deleteItem:a,updateItem:s}}const Ee=o=>(W("data-v-2ab1d0fa"),o=o(),X(),o),Pe={class:"q-mt-xl q-pa-md q-mx-md"},Ue=Ee(()=>_("div",{class:"text-h6 q-mb-md"},"Ergebnis konfigurieren",-1)),Te={class:"row"},Ae={class:"column"},Re={class:"text-italic text-caption"},Ge=q({__name:"CreateResultConfig",emits:["updateResultConfig"],async setup(o,{emit:e}){let t,a;const s=e,l=g(!1),m=g(!0),h=g(!0),v=g(!1),p=g([]),{data:n}=([t,a]=H(()=>C("game/starting-point-systems")),t=await t,a(),t),i=g(n[0]),c=g([]);function y(){return{isAsymmetric:l.value,hasPoints:h.value,startingPointSystem:i.value.id,hasStartingPlayerOrder:m.value,factions:c.value,hasTieBreaker:v.value,tieBreakers:p.value}}function O(){const P=y();s("updateResultConfig",P)}return ae([l,h,i,m,c,v,p],()=>O(),{immediate:!0}),(P,d)=>(u(),I("div",Pe,[Ue,_("div",Te,[r(Y,{class:"config-box q-pa-md"},{default:$(()=>[_("div",Ae,[r(V,{label:"Startspielerreihenfolge","model-value":m.value,"onUpdate:modelValue":d[0]||(d[0]=f=>m.value=!m.value)},null,8,["model-value"]),r(B),r(V,{label:"Punkte","model-value":h.value,"onUpdate:modelValue":d[1]||(d[1]=f=>h.value=!h.value)},null,8,["model-value"]),h.value?(u(),b(U,{key:0,class:"q-px-md q-pb-sm",modelValue:i.value,"onUpdate:modelValue":d[2]||(d[2]=f=>i.value=f),options:S(n),"option-value":"code","option-label":"code",label:"Startsiegpunktesystem"},null,8,["modelValue","options"])):k("",!0),_("div",Re,G(i.value.description),1),r(B),r(V,{label:"Assymmentrisch","model-value":l.value,"onUpdate:modelValue":d[3]||(d[3]=f=>l.value=!l.value)},null,8,["model-value"]),l.value?(u(),b(A,{key:1,"button-label":"Neue Faction",onUpdateList:d[4]||(d[4]=f=>c.value=f)})):k("",!0),r(B),r(V,{label:"Tie Breaker","model-value":v.value,"onUpdate:modelValue":d[5]||(d[5]=f=>v.value=!v.value)},null,8,["model-value"]),v.value?(u(),b(A,{key:2,"button-label":"Neuer Tiebreaker",ranked:"",onUpdateList:d[6]||(d[6]=f=>p.value=f)})):k("",!0)])]),_:1})])]))}});var Qe=E(Ge,[["__scopeId","data-v-2ab1d0fa"]]);function Le(){const o={};function e(s,l){o[s.toString()]=l}function t(s){return o[s.toString()]}function a(s){delete o[s.toString()]}return{IDStorage:o,addStorageItem:e,getStorageItem:t,removeStorageItem:a}}const{IDStorage:_t,addStorageItem:Z,getStorageItem:R}=Le();async function De(o,e){try{const{data:t}=await C("game/games/",{method:"POST",data:{name:o,platform:e.id}});return t.id}catch(t){throw console.log("Error while creating a new game",t),new Error("Could not create new game because of following error: "+t)}}async function Ne(o){if(o.onlyIfOption===void 0){console.log("No restriction option given",{option:o});return}const{onlyIfOption:e,onlyIfChoice:t,onlyIfValue:a}=o,s=R(e);if(s===void 0){console.error(`Invalid option: ${e}. It does not exist in optionIDStorage.`);return}const l={only_if_option:s};if(a!==void 0)console.log({onlyIfValue:a},"its a value"),l.only_if_value=a;else if(t!==void 0){console.log({onlyIfChoice:t},"its a choice");const m=R(t);if(m!==void 0)l.only_if_choice=m;else{console.error(`Invalid choice: ${t}. It does not exist in optionIDStorage.`);return}}else{console.error("Both onlyIfValue and onlyIfChoice are undefined. To set a restriction, at least one must be provided.");return}await C(`game/options/${s}/`,{method:"PATCH",data:l})}async function Fe(o,e){try{const{data:t}=await C("game/options/",{method:"POST",data:{name:o.title,has_choices:o.hasChoices,game:e}});return Z(o.itemId,t.id),t}catch(t){throw console.log("Error creating game options",t),new Error(`Error creating game options: 
`+t)}}async function je(o,e){try{const{data:t}=await C("game/option-choices/",{method:"POST",data:{name:o.name,option:e}});return Z(o.itemId,t.id),t}catch(t){throw console.log("Error creating game option choice",t),new Error(`Error creating game option choice: 
`+t)}}async function ze(o){if(!!o.hasChoices)for(const e of o.choices){const t=R(o.itemId);await je(e,t)}}async function Ke(o,e){for(const t of e)await Fe(t,o);for(const t of e)await ze(t),await Ne(t)}async function Me(o,e){try{const{data:t}=await C("game/result-configs/",{method:"POST",data:{game:o,is_asymmetric:e==null?void 0:e.isAsymmetric,has_starting_player_order:e==null?void 0:e.hasStartingPlayerOrder,has_points:e==null?void 0:e.hasPoints,starting_points_system:e==null?void 0:e.startingPointSystem}});await He(o,e),await We(t.id,e)}catch(t){throw console.log("Error creating the result configuration",t),new Error(`Error creating the result configuration: 
`+t)}}async function He(o,e){if(e!==void 0&&e.factions!==void 0)for(const t of e.factions)try{C("game/factions/",{method:"POST",data:{game:o,name:t.name}})}catch(a){console.log("Error creating faction",a)}}async function We(o,e){if(e!==void 0&&e.tieBreakers!==void 0&&!!e.hasTieBreaker)for(const[t,a]of e.tieBreakers.entries())try{C("game/tie-breakers/",{method:"POST",data:{result_config:o,name:a.name,order:t*10}})}catch(s){console.log("Error creating tieBreaker",s)}}const J=o=>(W("data-v-c18f725c"),o=o(),X(),o),Xe={class:"q-pa-md"},Ye=J(()=>_("p",{class:"text-h5"},"Neues Spiel",-1)),Ze={class:"q-py-md"},Je={class:"q-mt-xl q-pa-md"},et=J(()=>_("span",{class:"text-h6"},"Spieloptionen",-1)),tt={class:"flex row"},ot=q({__name:"GameCreate",async setup(o){let e,t;const a=ne(),s=le(),{data:l}=([e,t]=H(()=>C("game/platforms/")),e=await e,t(),e),m=Be(),{addItem:h,items:v}=m;se("useGameOptions",m);const p=g(""),n=g(void 0),i=g([]);let c;function y(d){c=d}function O(){const d={title:"",hasChoices:!1,itemId:Q(),choices:[]};h(d,{prepend:!0})}const P=async()=>{try{if(n.value===void 0)return;const d=await De(p.value,n.value);if(await Ke(d,v.value),c!==void 0)await Me(d,c);else{console.log("Missing result config");return}s.notify({color:"positive",textColor:"white",icon:"save",message:"Gespeichert"}),await a.push({name:"games"})}catch(d){console.log("Could not create game because ",d);const f="Fehler "+i.value;s.notify({color:"negative",textColor:"white",icon:"warning",message:f})}};return(d,f)=>(u(),I("div",Xe,[Ye,_("div",Ze,[r(ee,{onSubmit:f[2]||(f[2]=w=>P()),onKeydown:f[3]||(f[3]=z(T(()=>{},["stop","prevent"]),["enter"])),class:"q-gutter-md"},{default:$(()=>[r(j,{class:"max-w",label:"Spielname",modelValue:p.value,"onUpdate:modelValue":f[0]||(f[0]=w=>p.value=w),rules:[w=>!!w||"Bitte w\xE4hle einen Spielnamen"]},null,8,["modelValue","rules"]),r(U,{class:"max-w",label:"Plattform",options:S(l),modelValue:n.value,"onUpdate:modelValue":f[1]||(f[1]=w=>n.value=w),"option-value":"name","option-label":"name",rules:[w=>!!w||"Bitte w\xE4hle eine Plattform"]},null,8,["options","modelValue","rules"]),_("div",Je,[_("div",null,[et,r(x,{class:"q-ml-lg",color:"primary",label:"",icon:"add",onClick:O})]),_("div",tt,[(u(!0),I(K,null,M(S(v),w=>(u(),b(xe,{key:w.itemId,gameOption:w},null,8,["gameOption"]))),128))])]),r(Qe,{onUpdateResultConfig:y}),r(x,{class:"q-my-xl",type:"submit",push:"",color:"positive",label:"Speichern"})]),_:1})])]))}});var ht=E(ot,[["__scopeId","data-v-c18f725c"]]);export{ht as default};
