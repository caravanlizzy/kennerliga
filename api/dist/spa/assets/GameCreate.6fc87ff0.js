import{_ as j,Q as Z}from"./KennerInput.948dc72a.js";import{y as V,o as m,A as k,a6 as P,h as y,a as r,w as $,B as D,aa as z,a9 as K,_ as U,aW as G,c as g,ac as C,D as ee,F as f,aX as E,S as Q,T,m as F,R as te,C as w,af as M,d as ae,a8 as S,aR as W,aS as H,ab as oe,t as le}from"./index.ba6213b8.js";import{n as ne}from"./reponsive.58479fee.js";import{_ as R}from"./KennerSelect.76d83a67.js";import{_ as x}from"./KennerButton.2158b9fa.js";import{Q as q}from"./QToggle.6aed9517.js";import{a as N,Q as se}from"./QCardSection.fef8ccf3.js";import{Q as B}from"./use-checkbox.54462b67.js";import{Q as X}from"./QCard.99f6fced.js";import"./QSelect.9a9294f2.js";import"./scroll.a6f9976b.js";const ie={class:"q-pa-sm text-accent text-h6 row flex-center"},ue=V({__name:"KennerCounter",props:{content:{}},setup(i){return(e,a)=>(m(),k("div",ie,P(e.content+1),1))}});const re={class:"q-px-md q-pb-sm"},ce={key:0},me=["onClick"],de={key:0,class:"row"},pe={class:"column"},ve={class:"column justify-center item-start"},_e=V({__name:"ListCreator",props:{buttonLabel:{},ranked:{type:Boolean}},emits:["updateList"],setup(i,{emit:e}){const a=e,o=y([]),s=y({itemId:-1,name:"",isEditable:!1});function n(){!s.value.name||(s.value.itemId=G(),o.value.push({...s.value}),o.value.sort((t,l)=>t.name.localeCompare(l.name,void 0,{numeric:!0,sensitivity:"base"})),s.value={...s.value,isEditable:!1,name:""},p())}function v(t){t>0&&t<o.value.length&&([o.value[t],o.value[t-1]]=[o.value[t-1],o.value[t]]),p()}function h(t){t>=0&&t<o.value.length+1&&([o.value[t],o.value[t+1]]=[o.value[t+1],o.value[t]]),p()}function _(t){o.value=o.value.filter(l=>l!==t),p()}function p(){a("updateList",o.value.map(({isEditable:t,...l})=>l))}return(t,l)=>(m(),k("div",re,[r(N,{filled:"",square:"","bottom-slots":"","hide-bottom-space":"",label:t.buttonLabel,modelValue:s.value.name,"onUpdate:modelValue":l[0]||(l[0]=d=>s.value.name=d),onKeyup:D(n,["enter"])},{append:$(()=>[r(x,{round:"",dense:"",flat:"",icon:"add",onClick:n})]),_:1},8,["label","modelValue"]),(m(!0),k(z,null,K(o.value,(d,b)=>(m(),k("div",{key:d.id},[d.isEditable?(m(),k("div",ce,[r(N,{square:"","bottom-slots":"","hide-bottom-space":"",label:"editieren",color:"info",class:"text-white",modelValue:d.name,"onUpdate:modelValue":O=>d.name=O},{prepend:$(()=>[t.ranked?(m(),g(ue,{key:0,content:b},null,8,["content"])):C("",!0)]),append:$(()=>[r(x,{color:"info",dense:"",flat:"",icon:"check",onClick:O=>d.isEditable=!1,onBlur:O=>d.isEditable=!1},null,8,["onClick","onBlur"])]),_:2},1032,["modelValue","onUpdate:modelValue"])])):(m(),k("div",{key:1,onClick:()=>d.isEditable=!0,class:ee(["flex justify-between q-pa-sm rounded item-border",{"border-bottom":b===o.value.length-1}])},[t.ranked?(m(),k("div",de,[f("div",pe,[b>0?(m(),g(Q,{key:0,flat:"",icon:"arrow_drop_up",size:"sm",onClick:E(O=>v(b),["stop"])},null,8,["onClick"])):C("",!0),b<o.value.length-1?(m(),g(Q,{key:1,flat:"",icon:"arrow_drop_down",size:"sm",onClick:E(O=>h(b),["stop"])},null,8,["onClick"])):C("",!0)])])):C("",!0),f("div",ve,P(d.name),1),r(x,{icon:"close",onClick:O=>_(d),color:"accent",flat:"",dense:""},null,8,["onClick"])],10,me))]))),128))]))}});var A=U(_e,[["__scopeId","data-v-7cc80292"]]);const fe={class:"column q-pa-xs q-mt-lg"},he=f("div",{class:"q-mx-xs q-mb-xs text-bold"},"Auswahloptionen",-1),ye=V({__name:"GameOptionChoiceCreate",props:{gameOption:{},addChoice:{type:Function}},setup(i){const{updateItem:e}=T("useGameOptions"),a=i;function o(s){e(a.gameOption,"choices",s)}return(s,n)=>(m(),k("div",fe,[he,r(A,{"button-label":"Neue Option",onUpdateList:o})]))}}),be={class:"column q-pa-xs q-mt-lg bg-brown-1 q-pa-md"},ge=f("div",{class:"row items-center justify-between"},[f("div",{class:"q-mx-xs text-bold"},"Bedingung")],-1),ke=V({__name:"GameOptionRestrictionCreate",props:{gameOption:{}},setup(i){const e=i,{updateItem:a,items:o}=T("useGameOptions"),s=y(null),n=y({booleanActive:!0,choiceSelection:{name:null,itemId:null}}),v=F(()=>n.value.booleanActive?"Bedingte Option muss aktiv sein":"Bedingte Option muss inaktiv sein"),h=F(()=>o.value.filter(p=>p.title!==e.gameOption.title));function _(){var p,t,l,d;a(e.gameOption,"onlyIfOption",(p=s.value)==null?void 0:p.itemId),(t=s.value)!=null&&t.hasChoices?(a(e.gameOption,"onlyIfValue",void 0),a(e.gameOption,"onlyIfChoice",(l=n.value)==null?void 0:l.choiceSelection.itemId)):(a(e.gameOption,"onlyIfChoice",void 0),a(e.gameOption,"onlyIfValue",(d=n.value)==null?void 0:d.booleanActive))}return(p,t)=>(m(),k("div",be,[ge,r(B,{class:"q-mt-md q-mb-xs"}),r(R,{modelValue:s.value,"onUpdate:modelValue":[t[0]||(t[0]=l=>s.value=l),_],options:h.value,class:"q-my-md","option-value":"title","option-label":"title",label:"Option","map-options":"",rules:[l=>!!l||"Auswahl erforderlich"]},null,8,["modelValue","options","rules"]),s.value&&s.value.hasChoices?(m(),g(R,{key:0,modelValue:n.value.choiceSelection,"onUpdate:modelValue":[t[1]||(t[1]=l=>n.value.choiceSelection=l),_],options:s.value.choices,class:"q-my-md","option-value":"name","option-label":"name",label:"Bedingter Wert",rules:[l=>!!l||"Auswahl erforderlich"]},null,8,["modelValue","options","rules"])):s.value&&!s.value.hasChoices?(m(),g(q,{key:1,color:"accent","model-value":n.value.booleanActive,"onUpdate:modelValue":t[2]||(t[2]=l=>{n.value.booleanActive=!n.value.booleanActive,_()}),label:v.value},null,8,["model-value","label"])):C("",!0)]))}}),Ie={};function Oe(i,e){return m(),g(X,{bordered:"",class:"q-mt-lg column q-mx-md"},{default:$(()=>[r(B),r(se,null,{default:$(()=>[te(i.$slots,"content")]),_:3})]),_:3})}var Ce=U(Ie,[["render",Oe]]);const we={class:"flex justify-end"},$e={class:"col"},qe={class:"column"},Ve=V({__name:"GameOptionCreate",props:{gameOption:{}},setup(i){const e=i,{gameOption:a}=e,{updateItem:o,deleteItem:s}=T("useGameOptions"),n=y(!1);function v(l){o(a,"hasChoices",l)}function h(){n.value||(o(a,"onlyIfOption",void 0),o(a,"onlyIfChoice",void 0),o(a,"onlyIfValue",void 0))}function _(){s(e.gameOption)}function p(l){o(a,"title",l)}function t(){const l={itemId:G(),name:""};o(a,"choices",[...e.gameOption.choices,l])}return(l,d)=>(m(),g(Ce,null,{content:$(()=>[f("div",we,[r(x,{flat:"",color:"accent",size:"md",class:"close-button q-pa-none",icon:"delete",onClick:_})]),f("div",$e,[r(j,{"model-value":w(a).title,"onUpdate:modelValue":p,label:"Spieloption Titel",class:"q-mb-md q-mx-xs",rules:[b=>!!b||"Titel erforderlich"]},null,8,["model-value","rules"]),f("div",qe,[r(q,{"model-value":w(a).hasChoices,"onUpdate:modelValue":v,label:"Auswahloptionen"},null,8,["model-value"]),r(q,{label:"Bedingungen","model-value":n.value,"onUpdate:modelValue":d[0]||(d[0]=b=>{n.value=!n.value,h()})},null,8,["model-value"])]),w(a).hasChoices?(m(),g(ye,{key:0,addChoice:t,gameOption:w(a)},null,8,["gameOption"])):C("",!0),n.value?(m(),g(ke,{key:1,gameOption:w(a)},null,8,["gameOption"])):C("",!0)])]),_:1}))}});var xe=U(Ve,[["__scopeId","data-v-6a526f12"]]);function Se(i){const e=y([]);i&&e.value.push(...i);function a(n,{prepend:v=!1}={}){v?e.value.unshift(n):e.value.push(n)}function o(n){e.value=e.value.filter(v=>v.itemId!==n.itemId)}function s(n,v,h){const _=e.value.find(p=>p.itemId===n.itemId);_&&(_[v]=h)}return{items:e,addItem:a,deleteItem:o,updateItem:s}}const Be=i=>(W("data-v-2ab1d0fa"),i=i(),H(),i),Ue={class:"q-mt-xl q-pa-md q-mx-md"},Re=Be(()=>f("div",{class:"text-h6 q-mb-md"},"Ergebnis konfigurieren",-1)),Ee={class:"row"},Ae={class:"column"},Pe={class:"text-italic text-caption"},Ge=V({__name:"CreateResultConfig",emits:["updateResultConfig"],async setup(i,{emit:e}){let a,o;const s=e,n=y(!1),v=y(!0),h=y(!0),_=y(!1),p=y([]),{data:t}=([a,o]=M(()=>S("game/starting-point-systems")),a=await a,o(),a),l=y(t[0]),d=y([]);function b(){return{isAsymmetric:n.value,hasPoints:h.value,startingPointSystem:l.value.id,hasStartingPlayerOrder:v.value,factions:d.value,hasTieBreaker:_.value,tieBreakers:p.value}}function O(){const I=b();s("updateResultConfig",I)}return ae([n,h,l,v,d,_,p],()=>O(),{immediate:!0}),(I,c)=>(m(),k("div",Ue,[Re,f("div",Ee,[r(X,{class:"config-box q-pa-md"},{default:$(()=>[f("div",Ae,[r(q,{label:"Startspielerreihenfolge","model-value":v.value,"onUpdate:modelValue":c[0]||(c[0]=u=>v.value=!v.value)},null,8,["model-value"]),r(B),r(q,{label:"Punkte","model-value":h.value,"onUpdate:modelValue":c[1]||(c[1]=u=>h.value=!h.value)},null,8,["model-value"]),h.value?(m(),g(R,{key:0,class:"q-px-md q-pb-sm",modelValue:l.value,"onUpdate:modelValue":c[2]||(c[2]=u=>l.value=u),options:w(t),"option-value":"code","option-label":"code",label:"Startsiegpunktesystem"},null,8,["modelValue","options"])):C("",!0),f("div",Pe,P(l.value.description),1),r(B),r(q,{label:"Assymmentrisch","model-value":n.value,"onUpdate:modelValue":c[3]||(c[3]=u=>n.value=!n.value)},null,8,["model-value"]),n.value?(m(),g(A,{key:1,"button-label":"Neue Faction",onUpdateList:c[4]||(c[4]=u=>d.value=u)})):C("",!0),r(B),r(q,{label:"Tie Breaker","model-value":_.value,"onUpdate:modelValue":c[5]||(c[5]=u=>_.value=!_.value)},null,8,["model-value"]),_.value?(m(),g(A,{key:2,"button-label":"Neuer Tiebreaker",ranked:"",onUpdateList:c[6]||(c[6]=u=>p.value=u)})):C("",!0)])]),_:1})])]))}});var Te=U(Ge,[["__scopeId","data-v-2ab1d0fa"]]);async function Le(i,e){try{const{data:a}=await S("game/result-configs/",{method:"POST",data:{game:i,is_asymmetric:e==null?void 0:e.isAsymmetric,has_starting_player_order:e==null?void 0:e.hasStartingPlayerOrder,has_points:e==null?void 0:e.hasPoints,starting_points_system:e==null?void 0:e.startingPointSystem}});await Qe(i,e),await Fe(a.id,e)}catch(a){throw console.log("Error creating the result configuration",a),new Error(`Error creating the result configuration: 
`+a)}}async function Qe(i,e){if(e!==void 0&&e.factions!==void 0)for(const a of e.factions)try{S("game/factions/",{method:"POST",data:{game:i,name:a.name}})}catch(o){console.log("Error creating faction",o)}}async function Fe(i,e){if(e!==void 0&&e.tieBreakers!==void 0&&!!e.hasTieBreaker)for(const[a,o]of e.tieBreakers.entries())try{S("game/tie-breakers/",{method:"POST",data:{result_config:i,name:o.name,order:a*10}})}catch(s){console.log("Error creating tieBreaker",s)}}const J=i=>(W("data-v-60b39360"),i=i(),H(),i),Ne={class:"q-pa-md"},je=J(()=>f("p",{class:"text-h5"},"Neues Spiel",-1)),De={class:"q-py-md"},ze={class:"q-mt-xl q-pa-md"},Ke=J(()=>f("span",{class:"text-h6"},"Spieloptionen",-1)),Me={class:"flex row"},We=V({__name:"GameCreate",async setup(i){let e,a;const o=oe(),s=ne(),{data:n}=([e,a]=M(()=>S("game/platforms/")),e=await e,a(),e),v=Se(),{addItem:h,items:_}=v;le("useGameOptions",v);const p=y(""),t=y(void 0);y([]);let l;function d(I){l=I}function b(){const I={title:"",hasChoices:!1,itemId:G(),choices:[]};h(I,{prepend:!0})}const O=async()=>{try{if(!t.value)return;const I={name:p.value,platform:t.value.id,options:_.value.map(u=>{var L;return{name:u.title,has_choices:u.hasChoices,only_if_option:u.onlyIfOptionId||null,only_if_choice:u.onlyIfChoiceId||null,only_if_value:(L=u.onlyIfValue)!=null?L:null,choices:u.choices.map(Y=>({name:Y.name}))}})},{data:c}=await S.post("/game/games-full/",I);if(l!==void 0)await Le(c.id,l);else{console.warn("Missing result config");return}s.notify({color:"positive",textColor:"white",icon:"save",message:"Gespeichert"}),await o.push({name:"games"})}catch(I){console.error("Could not create game because",I),s.notify({color:"negative",textColor:"white",icon:"warning",message:"Fehler beim Speichern"})}};return(I,c)=>(m(),k("div",Ne,[je,f("div",De,[r(Z,{onSubmit:c[2]||(c[2]=u=>O()),onKeydown:c[3]||(c[3]=D(E(()=>{},["stop","prevent"]),["enter"])),class:"q-gutter-md"},{default:$(()=>[r(j,{class:"max-w",label:"Spielname",modelValue:p.value,"onUpdate:modelValue":c[0]||(c[0]=u=>p.value=u),rules:[u=>!!u||"Bitte w\xE4hle einen Spielnamen"]},null,8,["modelValue","rules"]),r(R,{class:"max-w",label:"Plattform",options:w(n),modelValue:t.value,"onUpdate:modelValue":c[1]||(c[1]=u=>t.value=u),"option-value":"name","option-label":"name",rules:[u=>!!u||"Bitte w\xE4hle eine Plattform"]},null,8,["options","modelValue","rules"]),f("div",ze,[f("div",null,[Ke,r(x,{class:"q-ml-lg",color:"primary",label:"",icon:"add",onClick:b})]),f("div",Me,[(m(!0),k(z,null,K(w(_),u=>(m(),g(xe,{key:u.itemId,gameOption:u},null,8,["gameOption"]))),128))])]),r(Te,{onUpdateResultConfig:d}),r(x,{class:"q-my-xl",type:"submit",push:"",color:"positive",label:"Speichern"})]),_:1})])]))}});var st=U(We,[["__scopeId","data-v-60b39360"]]);export{st as default};
